<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Geotraser - Operational Tracking - Puntos</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&display=swap" />

    <style>
        body {
          margin: 0;
          padding: 0;
          font-family: 'Montserrat', sans-serif;
          background-image: url('img/fondo_operationalTracking.png');
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
        }

        /* ===== CONTENEDOR SUPERIOR ===== */
        #encabezado {
          display: flex;
          justify-content: space-between; /* üü¢ t√≠tulo a la izquierda, controles a la derecha */
          align-items: center;
          padding: 10px 20px;
          background: rgba(0, 0, 0, 0.35);
          border-radius: 8px;
          margin: 10px;
        }

        /* ===== T√çTULOS ===== */
        .titulo-principal {
          color: #fff;
          font-size: 2rem;
          font-weight: 800;
          text-shadow: 3px 3px 10px rgba(0, 0, 0, 0.9);
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .titulo-secundario {
          color: #fff;
          font-size: 1.6rem;
          font-weight: 700;
          text-shadow: 3px 3px 10px rgba(0, 0, 0, 0.9);
          display: flex;
          align-items: center;
          gap: 8px;
          justify-content: center;
          margin-top: 10px;
        }

        /* ===== CONTROLES ===== */
        #controles-superiores {
          display: flex;
          gap: 10px;
          background: rgba(255, 255, 255, 0.9);
          padding: 10px;
          border-radius: 5px;
          align-items: center;
        }

        #controles-superiores button {
          padding: 6px 10px;
          font-weight: bold;
          border: 1px solid #999;
          background-color: white;
          border-radius: 5px;
          cursor: pointer;
        }

        #selector-usuario,
        #select-ruta {
          padding: 5px;
        }

        /* ===== MAPA ===== */
        #map {
          height: 85vh;
          margin-top: 10px;
        }

        footer {
          background-color: white;
          padding: 1rem;
          border-radius: 10px;
          box-shadow: 0 0 6px rgba(0,0,0,0.3);
        }

        footer img {
          max-width: 300px;
          display: block;
          margin: 0 auto;
        }

        /* RESPONSIVE */
        @media (max-width: 900px) {
          #encabezado {
            flex-direction: column;
            gap: 10px;
          }
        }
    </style>

    <!-- üîí Protecci√≥n de acceso con JWT -->
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
          const backendUrl = "https://navigationasistance-backend-1.onrender.com";
          const token = localStorage.getItem("authToken");

          console.log("Token en operationaltrackingpersonal.html =", token);

          if (!token) {
            window.location.replace("loginot.html");
            return;
          }

          try {
            const res = await fetch(`${backendUrl}/login/sesion/estado`, {
              method: "GET",
              headers: {
                "Authorization": `Bearer ${token}`
              }
            });

            console.log("Respuesta sesion/estado =", res.status);

            if (res.status !== 200) {
              localStorage.removeItem("authToken");
              window.location.replace("loginot.html");
            }
          } catch (e) {
            console.error("Error verificando sesi√≥n:", e);
            window.location.replace("loginot.html");
          }
        });
    </script>

</head>

<body id="page-top">
<!-- üß≠ Encabezado con t√≠tulo y controles en una sola l√≠nea -->
<div id="encabezado">
    <h1 class="titulo-principal">üß≠ Operational Tracking</h1>
    <div id="controles-superiores">
        <select id="select-ruta"><option disabled selected>Select a route</option></select>
        <select id="selector-usuario"><option disabled selected>Select a staff</option></select>
        <button id="boton-traza">Trace Route</button>
        <button id="boton-borrar-traza">Delete Trace</button>
    </div>
</div>

<h2 id="tituloRuta" class="titulo-secundario">üìç Checkpoints</h2>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="mapaop.js"></script>

<footer>
    <img src="img/negro_transparente_geotraser.png" alt="GEOTRASER">
</footer>
</body>
</html>
