<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Regatas Wind</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <style>
        /* ===== Vars para alturas (sin scroll) ===== */
        :root{
          --headerH: 160px;     /* desktop: header alto (t√≠tulo + chips) */
          --infoH: 0px;         /* desktop: no tira separada */
          --gapH: 0px;          /* respiraci√≥n */
          --top-offset: calc(var(--headerH) + var(--infoH) + var(--gapH));
        }

        @media (max-width: 640px){
          :root{
            --headerH: 72px;    /* mobile header compacto */
            --infoH: 44px;      /* tira horizontal de chips */
            --gapH: 10px;       /* respiro */
            --top-offset: calc(var(--headerH) + var(--infoH) + var(--gapH));
          }
        }

        html, body { height: 100%; margin: 0; }
        body { overflow: hidden; background: #0b3c55 url('img/fondo_regata.png') center/cover no-repeat; }

        /* ====== TOPBAR (franja azul) ====== */
        .topbar{
          position:fixed; top:0; left:0; right:0;
          height: var(--headerH);
          display:flex; align-items:center; justify-content:center;
          z-index:1100;
          background:linear-gradient(180deg, rgba(20,105,150,.95), rgba(20,105,150,.82));
          backdrop-filter:blur(4px);
          pointer-events:auto;
          padding:0 12px;
        }

        .logo{
          position:absolute; left:10px; top:50%; transform:translateY(-50%);
          height:64px; width:auto;
          filter:drop-shadow(2px 2px 4px rgba(0,0,0,.3));
        }

        /* Centro: t√≠tulo + chips (desktop) */
        .topbar-center{
          display:flex; flex-direction:column; align-items:center; gap:10px;
          max-width:80%;
        }

        .site-title{
          margin:0;
          font-size:34px; letter-spacing:2px; color:#fff;
          text-shadow:1px 1px 3px rgba(0,0,0,.5);
          text-align:center; line-height:1;
        }

        .subrow{
          display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:center;
        }

        /* Lado derecho: bot√≥n viento */
        .topbar-right{
          position:absolute; right:10px; top:50%; transform:translateY(-50%);
          display:flex; align-items:center; gap:12px;
        }

        /* Bot√≥n viento (desktop) */
        #toggle-viento{
          background:rgba(33,150,243,.95); color:#fff; border:none; border-radius:10px;
          padding:10px 14px; font-size:16px; cursor:pointer;
          transition:transform .15s ease, filter .15s ease, background .15s;
        }
        #toggle-viento.activo{ background:rgba(76,175,80,.95); }
        #toggle-viento:hover{ transform:translateY(-1px); filter:brightness(1.05); }

        /* Chips */
        .chip{
          display:inline-flex; align-items:center; gap:8px;
          padding:8px 12px; border-radius:999px;
          background:rgba(255,255,255,.14); color:#fff; font-weight:600; font-size:15px;
          box-shadow:inset 0 0 0 1px rgba(255,255,255,.15);
          white-space:nowrap;
        }
        .chip .chip-label{ opacity:.85; font-weight:500; }

        /* Contenedores de viento y m√©tricas (horizontal) */
        #panel-viento, #panel-metricas{
          display:flex; align-items:center; gap:10px;
          background:transparent; border:none; box-shadow:none; padding:0; margin:0;
          color:#fff;
        }

        /* Aguja del bearing (la rota tu JS) */
        .bearing-needle{ display:inline-block; transform-origin:center; transition:transform .5s ease; }

        /* ====== Tira de chips fija bajo el header (solo mobile) ====== */
        .chips-strip{
          position: fixed;
          left: 0; right: 0;
          top: var(--headerH);
          height: var(--infoH);
          display: none;                 /* desktop: oculta */
          align-items: center;
          gap: 8px;
          padding: 6px 60px 6px 8px;      /* respiro + lugar para bot√≥n */
          background: linear-gradient(180deg, rgba(20,105,150,.92), rgba(20,105,150,.80));
          overflow-x: auto;               /* scroll horizontal si no entra */
          -webkit-overflow-scrolling: touch;
          z-index: 1100;
        }

        /* ====== MAPA: ocupa lo que queda (sin scroll) ====== */
        #map{
          position: absolute;
          top: var(--top-offset);
          left: 0; right: 0; bottom: 0;
          height: calc(100vh - var(--top-offset));
        }

        /* Canvas part√≠culas (si lo us√°s) */
        #wind-canvas{ position:absolute; top:0; left:0; pointer-events:none; z-index:400; }

        /* Evita errores de JS si tocan el control escondido */
        #controles-superiores{ display:none; }

        /* ====== Mobile ====== */
        @media (max-width: 640px){
          /* Ocultar t√≠tulo en mobile */
          #site-title { display:none; }

          /* S√≥lo FARO (recortado) */
          .logo{
            width: 52px; height: 52px;
            object-fit: cover;
            object-position: left center;
          }

          /* Bot√≥n viento cuadrado e **a la misma altura que el faro** */
          #toggle-viento{
            position: fixed;
            top: 10px; right: 8px;
            width: 52px; height: 52px;
            padding: 0; border-radius: 12px;
            font-size: 0;             /* oculto texto */
          }
          #toggle-viento::before{
            content: "üå¨Ô∏è";
            display:block; font-size:22px; line-height:52px; text-align:center;
          }

          /* Los chips bajan a la tira fija */
          .chips-strip{ display:flex; }
          /* En mobile, ya no mostramos chips en el centro del header */
          .topbar-center .subrow{ display:none; }

          /* Footer fuera para no generar scroll */
          footer { display:none; }
        }
    </style>
</head>

<body>

<!-- HEADER -->
<div class="topbar">
    <img src="img/negro_transparente_geotraser.png" alt="GEOTRASER" class="logo">

    <div class="topbar-center">
        <!-- t√≠tulo din√°mico (tu JS setea innerText) -->
        <h1 id="site-title" class="site-title"></h1>

        <!-- fila debajo del t√≠tulo (s√≥lo desktop) -->
        <div class="subrow">
            <!-- Viento -->
            <div id="panel-viento">
                <div class="chip"><span class="chip-label">Dir</span><span id="vientoDir">‚Äì</span></div>
                <div class="chip"><span class="chip-label">Vel</span><span id="vientoVel">‚Äì</span></div>
                <div class="chip"><span class="chip-label">R√°f</span><span id="vientoRafagas">‚Äì</span></div>
            </div>

            <!-- M√©tricas -->
            <div id="panel-metricas">
                <div class="chip">
                    <span class="chip-label">Bearing</span>
                    <span id="bearing-value">---¬∞</span>
                    <span id="bearing-needle" class="bearing-needle">‚Üë</span>
                </div>
                <div class="chip"><span class="chip-label">Dist</span><span id="distancia-value">0.00</span></div>
                <div class="chip"><span class="chip-label">Veloc</span><span id="velocidad-value">0.0</span></div>
            </div>
        </div>
    </div>

    <!-- Bot√≥n -->
    <div class="topbar-right">
        <button id="toggle-viento" onclick="toggleCapaViento()">üå¨Ô∏è Viento ON</button>
    </div>
</div>

<!-- Tira de chips (s√≥lo mobile, mismo contenido para que el JS funcione igual) -->
<div class="chips-strip">
    <div id="panel-viento">
        <div class="chip"><span class="chip-label">Dir</span><span id="vientoDir">‚Äì</span></div>
        <div class="chip"><span class="chip-label">Vel</span><span id="vientoVel">‚Äì</span></div>
        <div class="chip"><span class="chip-label">R√°f</span><span id="vientoRafagas">‚Äì</span></div>
    </div>
    <div id="panel-metricas">
        <div class="chip">
            <span class="chip-label">Bearing</span>
            <span id="bearing-value">---¬∞</span>
            <span id="bearing-needle" class="bearing-needle">‚Üë</span>
        </div>
        <div class="chip"><span class="chip-label">Dist</span><span id="distancia-value">0.00</span></div>
        <div class="chip"><span class="chip-label">Veloc</span><span id="velocidad-value">0.0</span></div>
    </div>
</div>

<!-- Control oculto (evita error de tu JS) -->
<div id="controles-superiores">
    <label>Ancho del Control (m): <span id="anchoLabel">10</span></label>
    <input type="range" id="anchoCorredor" min="0" max="100" value="10" />
</div>

<!-- MAPA -->
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="maparepew.js"></script>

<!-- Footer se oculta en mobile para no generar scroll -->
<footer style="background-color:white; padding:1rem; border-radius:10px; box-shadow:0 0 6px rgba(0,0,0,0.3); text-align:center;">
    <img src="img/negro_transparente_geotraser.png" alt="GEOTRASER" style="max-width:300px;">
</footer>
</body>
</html>
