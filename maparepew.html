<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Regatas Wind</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        :root{
          --topbar-h-desktop: 120px;
          --topbar-h-mobile: 64px;
          --chipsbar-h-mobile: 36px;
          --azul-1: rgba(20,105,150,.95);
          --azul-2: rgba(20,105,150,.82);
        }

        /* ===== TOPBAR (franja azul) - GRID: logo | centro | acciones ===== */
        .topbar{
          position: fixed; inset: 0 0 auto 0;
          height: var(--topbar-h-desktop);
          display: grid;
          grid-template-columns: auto 1fr auto;
          align-items: center;
          gap: 12px;
          padding: 0 12px;
          z-index: 1100;
          background: linear-gradient(180deg, var(--azul-1), var(--azul-2));
          backdrop-filter: blur(4px);
          color: #fff;
        }

        .topbar .logo{
          max-height: 64px; width: auto;
          filter: drop-shadow(2px 2px 4px rgba(0,0,0,.3));
        }

        .topbar-center{
          display: flex; flex-direction: column; align-items: center; gap: 8px;
          min-width: 0; /* para que el overflow-x del row funcione */
        }

        .site-title{
          margin: 0; font-size: 32px; letter-spacing: 2px; color:#fff;
          text-shadow: 1px 1px 3px rgba(0,0,0,.5);
          text-align: center; line-height: 1;
        }

        /* FILA DE CHIPS DENTRO DEL HEADER (desktop) */
        .chips-row{
          display: flex; align-items: center; gap: 8px;
          max-width: 100%;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
          scrollbar-width: none;
        }
        .chips-row::-webkit-scrollbar{ display: none; }

        .chip{
          display: inline-flex; align-items: center; gap: 6px;
          padding: 6px 10px; border-radius: 999px;
          background: rgba(255,255,255,.14); color:#fff; font-weight: 600; font-size: 14px;
          box-shadow: inset 0 0 0 1px rgba(255,255,255,.15);
          white-space: nowrap;
        }
        .chip .chip-label{ opacity:.85; font-weight:500; }
        .chip span[id$="-value"], .chip #bearing-value{ font-weight:700; }

        /* grupo viento + grupo m√©tricas reutilizando tus IDs */
        #panel-viento, #panel-metricas{ display: contents; } /* no envuelven, solo pasan los chips */

        /* ACCIONES A LA DERECHA */
        .topbar-actions{ display: flex; align-items:center; gap: 10px; }

        #toggle-viento{
          background: rgba(33,150,243,.95);
          color:#fff; border:none; border-radius:10px;
          padding: 10px 14px; font-size: 16px; cursor: pointer;
          transition: transform .15s ease, filter .15s ease, background .15s;
          display: inline-flex; align-items:center; gap:8px;
        }
        #toggle-viento:hover{ transform: translateY(-1px); filter: brightness(1.05); }
        #toggle-viento.activo{ background: rgba(76,175,80,.95); }

        /* MAPA */
        body{ margin:0; padding-top: var(--topbar-h-desktop); }
        #map{ height: calc(100vh - var(--topbar-h-desktop)); position: relative; }
        #wind-canvas{ position:absolute; top:0; left:0; pointer-events:none; z-index:400; }

        /* ====== MOBILE (‚â§ 640px) ====== */
        @media (max-width:640px){
          .topbar{ height: var(--topbar-h-mobile); grid-template-columns: auto 1fr auto; }
          .topbar .logo{ max-height: 40px; }
          .site-title{ display: none; } /* ocultar t√≠tulo en mobile */
          /* bot√≥n cuadrado solo con el √≠cono */
          #toggle-viento{
            width: 44px; height: 44px; padding: 0; border-radius: 10px;
            justify-content: center; font-size: 22px;
          }
          #toggle-viento span.label{ display:none; } /* oculto texto, dejo solo emoji/icono */

          /* La fila de chips baja a una barra propia fija debajo del header */
          .chips-row{
            position: fixed; left:0; right:0; top: var(--topbar-h-mobile);
            height: var(--chipsbar-h-mobile);
            padding: 6px 8px;
            background: linear-gradient(180deg, rgba(20,105,150,.92), rgba(20,105,150,.80));
            z-index: 1099;
          }

          /* Ajusto el alto √∫til del mapa y el padding del body para no taparlo */
          body{ padding-top: calc(var(--topbar-h-mobile) + var(--chipsbar-h-mobile)); }
          #map{ height: calc(100vh - (var(--topbar-h-mobile) + var(--chipsbar-h-mobile))); }
        }
    </style>
</head>
<body id="page-top" style="background-image:url('img/fondo_regata.png'); background-size:cover; background-position:center; background-repeat:no-repeat;">

<!-- TOPBAR -->
<header class="topbar">
    <!-- IZQ: faro -->
    <img src="img/negro_transparente_geotraser.png" alt="GEOTRASER" class="logo" />

    <!-- CENTRO: t√≠tulo + fila de chips -->
    <div class="topbar-center">
        <!-- T√≠tulo din√°mico (completado por tu JS con ruta.nombre) -->
        <h1 id="site-title" class="site-title"></h1>

        <!-- Fila con Viento + M√©tricas (todos como chips, en una sola l√≠nea) -->
        <div class="chips-row" id="chips-row">
            <!-- Viento -->
            <div id="panel-viento">
                <div class="chip"><span class="chip-label">Dir</span><span id="vientoDir">‚Äì</span></div>
                <div class="chip"><span class="chip-label">Vel</span><span id="vientoVel">‚Äì</span></div>
                <div class="chip"><span class="chip-label">R√°f</span><span id="vientoRafagas">‚Äì</span></div>
            </div>
            <!-- M√©tricas -->
            <div id="panel-metricas">
                <div class="chip"><span class="chip-label">Bearing</span><span id="bearing-value">---¬∞</span></div>
                <div class="chip"><span class="chip-label">Dist</span><span id="distancia-value">0.00</span></div>
                <div class="chip"><span class="chip-label">Veloc</span><span id="velocidad-value">0.0</span></div>
            </div>
        </div>
    </div>

    <!-- DER: bot√≥n viento -->
    <div class="topbar-actions">
        <button id="toggle-viento" onclick="toggleCapaViento()">
            <span>üå¨Ô∏è</span><span class="label">Viento ON</span>
        </button>
    </div>
</header>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="maparepew.js"></script>

<!-- (footer opcional) -->
</body>
</html>
